<div class="register-container">

  <div class="register-card-wrapper">

    <div class="register-card">

      <div class="card-content">

        <div class="filling-form-card-content"
             [ngClass]="{ submitting: submitting, 'has-submit-error': !!error }">

          <span class="title">Register</span>

          <form id="register"
                [formGroup]="registerFormGroup"
                (ngSubmit)="onSubmit()">

            <div class="user-details">

              <div class="input-field username">
                <input id="username"
                       type="text"
                       formControlName="username"
                       [(ngModel)]="model.username"
                       [ngClass]="{ 'validation-pending': registerFormGroup.controls.username.pending }"/>
                <label for="username">Username</label>
                <div class="async-validation-indicator" [ngClass]="{ 'pending': registerFormGroup.controls.username.pending }">
                  <circular-loading></circular-loading>
                </div>
                <div class="form-validation-errors">
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': isFieldHasError(registerFormGroup.controls.username, 'required') }">
                    Username is required
                  </div>
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': isFieldHasError(registerFormGroup.controls.username, 'usernameTaken', false) }">
                    Username is taken
                  </div>
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': isFieldHasError(registerFormGroup.controls.username, 'usernameTakenCheckFailed', false) }">
                    Failed checking if username exists
                  </div>
                </div>
              </div>

              <div class="input-field email">
                <input id="email"
                       type="email"
                       formControlName="email"
                       [(ngModel)]="model.email"/>
                <label for="email">Email</label>
                <div class="form-validation-errors">
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': isFieldInvalid(registerFormGroup.controls.email) }">
                    The email is not valid
                  </div>
                </div>
              </div>

            </div>

            <div class="passwords" ngModelGroup="passwordsGroup">

              <div class="input-field password">
                <input id="password"
                       type="password"
                       formControlName="password"
                       [(ngModel)]="model.password"/>
                <label for="password">Password</label>
                <div class="form-validation-errors">
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': isFieldInvalid(passwordsGroup.controls.password) }">
                    Password is required
                  </div>
                </div>
              </div>

              <div class="input-field repeat-password">
                <input id="repeat-password"
                       type="password"
                       formControlName="repeatPassword"
                       [(ngModel)]="model.repeatPassword"/>
                <label for="repeat-password">Repeat the password</label>
                <div class="form-validation-errors">
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': wasFieldEdited(passwordsGroup.controls.repeatPassword) && !passwordsGroup.valid }">
                    The passwords don't match
                  </div>
                </div>
              </div>

            </div>

            <div class="credentials">

              <div class="input-field first-name">
                <input id="first-name"
                       type="text"
                       formControlName="firstName"
                       [(ngModel)]="model.firstName"/>
                <label for="first-name">First name</label>
                <div class="form-validation-errors">
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': isFieldInvalid(registerFormGroup.controls.firstName) }">
                    First name is required
                  </div>
                </div>
              </div>

              <div class="input-field last-name">
                <input id="last-name"
                       type="text"
                       formControlName="lastName"
                       [(ngModel)]="model.lastName"/>
                <label for="last-name">Last name</label>
                <div class="form-validation-errors">
                  <div class="form-validation-error" [ngClass]="{ 'has-errors': isFieldInvalid(registerFormGroup.controls.lastName) }">
                    Last name is required
                  </div>
                </div>
              </div>

            </div>

            <div class="submit-error">
              {{error}}
            </div>

            <div class="submit-wrapper">
              <button type="submit"
                      class="submit-button"
                      [disabled]="!registerFormGroup.valid"
                      [ngClass]="{ disabled: !registerFormGroup.valid }">
                     Register
              </button>
            </div>
          </form>

        </div>

        <div class="submitting-form-card-content" [ngClass]="{ submitting: submitting }">
          <circular-loading></circular-loading>
        </div>

      </div>

      <div class="card-action" [ngClass]="{ submitting: submitting }">
        Have an account? <a [routerLink]="['']">Sign in</a>
      </div>

    </div>

  </div>

</div>
